# Jira Xray Playwright + AI Test Generation

## Overview
This project automates the creation of Xray Test issues in Jira using Playwright. It features an AI-powered engine (supporting both local Ollama models and cloud OpenAI) to generate test cases directly from Jira User Stories.

## Prerequisites
- **Node.js**: 18+
- **Playwright**: For browser automation.
- **Ollama (Optional)**: If running local AI.
  - Ensure a model is available (e.g., `llama3.1:8b`).
  - Check via: `curl http://localhost:11434/api/tags`

## Setup

1.  **Install Dependencies**:
    ```bash
    npm install
    npx playwright install
    ```

2.  **Environment Variables**:
    Create a `.env` file in the root directory (do not commit this file). Add your secrets:
    ```env
    # Jira Credentials
    JIRA_USERNAME=your_email@example.com
    JIRA_PASSWORD=your_api_token_or_password

    # OpenAI (If using cloud AI)
    OPENAI_API_KEY=sk-...
    ```

3.  **Configuration**:
    Edit [config.json](file:///config.json) to set your project defaults:
    - `jira.baseUrl`: Your Jira instance URL.
    - `jira.projectKeyDefault`: Default project key (e.g., "XTP").
    - `ai.provider`: `ollama` or `openai`.
    - `ai.baseUrl`: AI API endpoint (e.g., `http://localhost:11434` or `https://api.openai.com`).
    - `ai.model`: Model name (e.g., `llama3.1:8b` or `gpt-4`).

## Usage: Generate Tests with AI

The `generate-tests` script allows you to fetch a User Story from Jira, generate test cases using AI, and automatically create those tests in Jira Xray.

### 1. Full Automation (Fetch -> Generate -> Create)
Fetches the story, generates tests, saves them locally, and immediately creates them in Jira.
```bash
npm run generate-tests -- <ISSUE_KEY> [PROJECT_KEY]
# Example:
npm run generate-tests -- SNAPS-1571 XTP
```

### 2. Generate Only (Fetch -> Generate)
Fetches the story and generates the test file locally (e.g., `Projects/XTP/SNAPS-1571.json`) but does NOT create them in Jira yet. Useful for reviewing the AI output before execution.
```bash
npm run generate-tests -- FILE <ISSUE_KEY> [PROJECT_KEY]
# Example:
npm run generate-tests -- FILE SNAPS-1571 XTP
```

### 3. Execute Only (Create in Jira)
Reads an existing test file (generated by step 2) and creates the issues in Jira.
```bash
npm run generate-tests -- JIRA <ISSUE_KEY> [PROJECT_KEY]
# Example:
npm run generate-tests -- JIRA SNAPS-1571 XTP
```

## Usage: Manual / Data Driven

You can also define tests manually in `data.json` and run the Playwright scripts directly.

1.  **Configure Data**: Edit `data.json` with your test data.
2.  **Run Scripts**:
    - Create Tests: `npx playwright test tests/create_tests.spec.ts`
    - Create Test Sets: `npx playwright test tests/create_test_sets.spec.ts`

## Critical: Updating Selectors

Since this automation interacts with your specific Jira instance, the selectors in `tests/pages/` are **generic**. You **MUST** inspect your Jira page and update them.

### `tests/pages/LoginPage.ts`
- Update `input[name="os_username"]` and `input[name="os_password"]` if your login form is different.

### `tests/pages/CreateIssuePage.ts`
- **Xray Fields**: Xray uses custom fields (e.g., `customfield_12345`).
- **Action**: Open Jira, click "Create", and inspect the "Test Type", "Test Set", etc. fields using Chrome DevTools.
- Update the IDs in `CreateIssuePage.ts` accordingly.

## AI Integration Options

### Local (Ollama)
- Set `ai.provider` to `ollama` in `config.json`.
- Ensure Ollama is running (`ollama serve`).
- Example `ai.baseUrl`: `http://localhost:11434`

### Cloud (OpenAI)
- Set `ai.provider` to `openai` in `config.json`.
- Ensure `OPENAI_API_KEY` is set in your `.env` file.
- Example `ai.baseUrl`: `https://api.openai.com`

## Visual Mode
To see what's happening during execution and debug selectors:
```bash
npx playwright test --ui
```

## Notes
- Keep secrets out of version control.
- Adjust Jira selectors if your instance uses a different UI.
